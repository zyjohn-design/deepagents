# 马拉松赛事场景知识库

## 场景代码
`marathon`

---

## 枚举定义

### SCENE_KEYWORDS（场景识别关键词）
```yaml
keywords:
  - 马拉松
  - 赛事
  - 起跑
  - 比赛线路
  - 关门时间
  - 鸣枪
  - 全程
  - 半程
  - 选手
  - 赛道
```

### PHASE_ENUM（阶段枚举）
```yaml
phases:
  - name: 赛前准备阶段
    code: pre_race
    keywords: [赛前, 准备, 禁停, 封闭, 检录]
    time_range: "赛前1天至起跑前"
    
  - name: 赛事进行阶段
    code: racing
    keywords: [赛事, 进行, 鸣枪, 起跑, 比赛, 禁行]
    time_range: "鸣枪起跑 - 关门时间"
    
  - name: 赛后恢复阶段
    code: post_race
    keywords: [赛后, 恢复, 开放, 撤除]
    time_range: "最后选手完赛 - 赛道完全开放"
    
  - name: 全时段保障
    code: continuous
    keywords: [保障, 应急, 医疗, 危险品]
    time_range: "贯穿全程"
```

### AREA_TYPE_ENUM（区域类型枚举）
```yaml
area_types:
  - type: 起点区
    code: start_zone
    keywords: [起点, 起跑区, 集结区, 检录区]
    description: 选手起跑集结区域
    
  - type: 终点区
    code: finish_zone
    keywords: [终点, 冲线区, 完赛区]
    description: 选手冲线及赛后服务区域
    
  - type: 线路
    code: race_route
    keywords: [比赛线路, 赛道, 全程, 半程, 13公里]
    description: 比赛路线
```

### ACTION_ENUM（动作类型枚举）
```yaml
actions:
  - action: 禁止
    keywords: [禁止, 限制, 不得]
    
  - action: 封闭
    keywords: [封闭, 封路, 临时封闭]
    
  - action: 恢复
    keywords: [恢复, 开放, 放行, 撤除]
    
  - action: 部署
    keywords: [部署, 到岗, 就位]
    
  - action: 鸣枪
    keywords: [鸣枪, 起跑, 出发]
    
  - action: 完成
    keywords: [完成, 结束]
```

### CONTROL_TYPE_ENUM（管控类型枚举）
```yaml
control_types:
  - type: 全封闭
    patterns: [禁止.*通行, 临时封闭, 封闭]
    description: 禁止所有车辆通行
    
  - type: 车辆禁停
    patterns: [禁止.*停放, 禁停]
    description: 禁止车辆停放
    
  - type: 交通管制
    patterns: [交通管制, 交通限制]
    description: 限制性通行措施
    
  - type: 临时管控
    patterns: [临时管控, 视情]
    description: 根据情况临时实施
```

---

## 区域与线路提取约束

### 一、线路 (type: 线路) boundaries 约束

线路是一条**有起点和终点的有向路径**（开放线段），不是封闭区域。

#### 1. 方向性与有序性
- boundaries 必须按照选手奔跑方向**依次列出**沿途道路，保持顺序
- 格式为 "A→B→C→D→终点(XX)" 或 "A-B-C-D"
- 起点和终点必须明确标注

#### 2. 路线完整性
- 必须提取文档中列出的**所有途经道路**，不可省略中间路段
- 每条道路的范围标注必须保留，如"沿江大道(三阳路口至南京路口)"
- 转弯点/路口必须保留，如"→珞喻路(街道口至光谷广场)"

#### 3. 多条线路区分
- 如果存在全程/半程/迷你跑等多条线路，必须**分别提取为独立记录**
- area_name 应明确区分，如"全程马拉松路线"、"半程马拉松路线"、"13公里跑路线"
- 不同线路可能共用部分路段，但 boundaries 各自独立完整

#### 4. 提取格式
```
正确: "沿江大道三阳路口→中山大道→武胜路→沿河大道→鹦鹉大道→长江大桥→武珞路→东湖路→欢乐大道→全程终点(武汉欢乐谷)"
错误: "比赛线路"                    ← 太模糊，没有实际路径
错误: "沿江大道、中山大道、武胜路"    ← 无方向性，不知道顺序
错误: "从起点到终点"                 ← 没有具体路段
```

### 二、起点区/终点区 (type: 起点区/终点区) boundaries 约束

起点区和终点区是**合围区域**（封闭多边形），与跨年夜管控区的约束相同。

#### 1. 合围闭合性
- boundaries 必须构成封闭环，以"合围区域"结尾
- 起点区通常以起跑线为中心，包含集结区、检录区
- 终点区通常以冲线点为中心，包含完赛服务区

#### 2. 边界道路完整性
- 必须提取构成合围的所有边界道路
- 含/不含标注必须保留

#### 3. 提取格式
```
正确: "沿江大道(含)-黄浦大街(不含)-中山大道(不含)-三阳路(不含)合围区域"
错误: "起点附近"                ← 过于模糊
错误: "起点区"                  ← 这是 area_name，不是 boundaries
```

### 三、赛道沿线设施（不单独提取为区域）

以下内容属于赛道的附属信息，**不应单独作为区域提取**，而应体现在 tasks 的 description 中：
- 补给站位置（如"5公里处设补给站"）
- 关门点位置（如"30公里关门点"）
- 医疗站位置
- 厕所/更衣点

### 四、赛道沿线的桥梁/隧道处理

文档中提到的桥梁、隧道（如"长江大桥"、"长江隧道"）有两种情况：

1. **作为线路的一部分**：选手会跑过该桥/隧道 → 归入对应线路的 boundaries 中
2. **独立封闭管控**：该桥/隧道不在赛道上，但因赛事需要临时封闭 → 在 tasks 中体现，affected_area 归入最近的起点区/终点区/线路

---

## 阶段详细说明

### 1. 赛前准备阶段 (pre_race)

**典型任务**（以武汉马拉松为例）:
| 时间点 | 任务类型 | 示例 |
|-------|---------|------|
| 赛前1天14时 | 禁停启动 | 比赛线路禁止车辆停放 |
| 赛前1天22时 | 提前封闭 | 指定路段禁止车辆停放和通行 |
| 比赛日1时 | 隧道封闭 | 长江隧道进出口临时封闭 |
| 比赛日0时 | 起点管控 | 起点周边道路禁止车辆通行 |
| 比赛日5时 | 扩大管控 | 更多路段禁止车辆通行 |

### 2. 赛事进行阶段 (racing)

**典型任务**:
| 时间点 | 任务类型 | 示例 |
|-------|---------|------|
| 6:30 | 路段封闭 | 中山大道、武胜路等禁行 |
| 6:45 | 桥梁封闭 | 江汉桥、长江大桥禁行 |
| 7:00 | 鸣枪起跑 | 全程马拉松出发 |
| 7:15 | 半程封闭 | 彭刘杨路等路段禁行 |
| 7:30 | 继续扩展 | 沙湖大桥、东湖路段禁行 |
| 7:45 | 东湖管控 | 东湖南路禁行 |
| 8:00 | 终点管控 | 欢乐大道等终点区域禁行 |

### 3. 赛后恢复阶段 (post_race)

**恢复原则**:
- "本区域比赛结束"后恢复
- 前段选手通过后可提前开放
- 最后关门时间后全面恢复

---

## 专业术语表

### 赛事术语
| 术语 | 含义 |
|-----|------|
| 关门时间 | 赛道收尾的截止时间（如6小时15分钟） |
| 分枪出发 | 不同组别分批次起跑 |
| 收容车 | 接送退赛或超时选手的车辆 |
| 关门点 | 设置时间限制的检查点 |
| 补给站 | 提供饮水和食物的服务点 |
| 本区域比赛结束 | 该路段最后一名选手通过或关门时间到达 |

### 路段表达模式
| 模式 | 示例 |
|-----|------|
| 路段范围 | 沿江大道(一元路至南京路) |
| 多路段列举 | 洞庭街(上海路至南京路)；一元路、蔡锷路... |
| 合围区域 | 沿江大道(含)-黄浦大街(不含)-中山大道(不含)合围区域 |
| 有向线路 | 起点→沿江大道→中山大道→武胜路→...→终点 |

---

## 提取模式示例

### 赛前禁停
```
原文: 3月22日14时起至比赛结束，以下道路禁止车辆停放：（一）所有比赛线路
提取: {
    "phase": "赛前准备阶段",
    "start_time": "2025-03-22 14:00",
    "end_time": "比赛结束",
    "control_type": "车辆禁停",
    "action": "禁止",
    "description": "比赛线路禁止车辆停放"
  }
```

### 分时段道路管控
```
原文: 6时30分起至本区域比赛结束，以下道路禁止车辆通行：中山大道(黄石路至崇仁路)；武胜路(中山大道至沿河大道)；武胜路高架桥；江汉桥。
提取:
  tasks: [{
    "phase": "赛事进行阶段",
    "start_time": "2025-03-23 06:30",
    "end_time": "本区域比赛结束",
    "control_type": "全封闭",
    "action": "禁止",
    "affected_area": "全程马拉松路线",
    "description": "中山大道(黄石路至崇仁路)、武胜路、武胜路高架桥、江汉桥禁止车辆通行"
  }]
注意: 具体路段归纳到所属线路，不单独建区域
```

### 隧道封闭
```
原文: 3月23日1时起至本区域比赛结束，长江隧道所有进出口、长江公铁隧道五福路出口均临时封闭。
提取:
  tasks: [{
    "phase": "赛前准备阶段",
    "start_time": "2025-03-23 01:00",
    "end_time": "本区域比赛结束",
    "control_type": "全封闭",
    "action": "封闭",
    "affected_area": "全程马拉松路线",
    "description": "长江隧道所有进出口、长江公铁隧道五福路出口临时封闭"
  }]
注意: 隧道不在赛道上但因赛事封闭 → task 的 affected_area 归入最近线路
```